
<div class="card">
  <div class="card-header">
    <h6 class="lead text-center pt-2">SQL Exercise <%= @exercise.id %></h6>
  </div>
  <div class="row card-body m-4">
    <code class="pb-2 text-secondary"><%= @exercise.description %></code>

    <%= form_with model: @exercise, data: { controller: "form-validation" } do |form| %>
      <%= form.hidden_field :exercise_id, value: @exercise.id %>

      <div class="sql-editor">
        <div class="editor-wrapper">
          <div class="line-numbers">
            <!-- Fixed line numbers from 1 to 8 -->
            <span>1</span>
            <span>2</span>
            <span>3</span>
            <span>4</span>
            <span>5</span>
            <span>6</span>
            <span>7</span>
            <span>8</span>
          </div>
          <%= form.text_area :user_answer, class: "code overflow-hidden", rows: 8, data: { target: "form-validation.textarea" }, oninput: "limitCharacters(this, 50);" %>
        </div>
      </div>
      <div class="d-flex">
        <div class="mt-3 mr-2">
          <%= form.button 'Submit', class: 'btn btn-light text-secondary border', data: { action: "form-validation#validate", exercise_id: @exercise.id } %>
        </div>
        <div class="ms-auto mt-2 px-2">
          <code id="form-validation"></code>
        </div>
      </div>
    <% end %>
  </div>
</div>

<script>
  function limitCharacters(textarea, lineCharacterLimit) {
    const lines = textarea.value.split('\n');
    if (lines.length > 8) {
        // If there are more than 8 lines, remove the extra lines
        lines.length = 8;
    }

    for (let i = 0; i < lines.length; i++) {
        if (lines[i].length > lineCharacterLimit) {
            // If a line exceeds the character limit, truncate it
            lines[i] = lines[i].slice(0, lineCharacterLimit);
        }
    }

    // Update the textarea's value with the modified lines
    textarea.value = lines.join('\n');
  }
</script>
